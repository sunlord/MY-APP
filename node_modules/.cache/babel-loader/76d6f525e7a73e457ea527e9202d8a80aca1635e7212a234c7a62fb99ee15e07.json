{"ast":null,"code":"import { __extends } from \"tslib\";\nimport Definable from './Definable';\nimport * as zrUtil from '../../core/util';\nimport { createOrUpdateImage } from '../../graphic/helper/image';\nimport WeakMap from '../../core/WeakMap';\nfunction isPattern(value) {\n  return value && (!!value.image || !!value.svgElement);\n}\nvar patternDomMap = new WeakMap();\nvar PatternManager = function (_super) {\n  __extends(PatternManager, _super);\n  function PatternManager(zrId, svgRoot) {\n    return _super.call(this, zrId, svgRoot, ['pattern'], '__pattern_in_use__') || this;\n  }\n  PatternManager.prototype.addWithoutUpdate = function (svgElement, displayable) {\n    if (displayable && displayable.style) {\n      var that_1 = this;\n      zrUtil.each(['fill', 'stroke'], function (fillOrStroke) {\n        var pattern = displayable.style[fillOrStroke];\n        if (isPattern(pattern)) {\n          var defs = that_1.getDefs(true);\n          var dom = patternDomMap.get(pattern);\n          if (dom) {\n            if (!defs.contains(dom)) {\n              that_1.addDom(dom);\n            }\n          } else {\n            dom = that_1.add(pattern);\n          }\n          that_1.markUsed(displayable);\n          var id = dom.getAttribute('id');\n          svgElement.setAttribute(fillOrStroke, 'url(#' + id + ')');\n        }\n      });\n    }\n  };\n  PatternManager.prototype.add = function (pattern) {\n    if (!isPattern(pattern)) {\n      return;\n    }\n    var dom = this.createElement('pattern');\n    pattern.id = pattern.id == null ? this.nextId++ : pattern.id;\n    dom.setAttribute('id', 'zr' + this._zrId + '-pattern-' + pattern.id);\n    dom.setAttribute('x', '0');\n    dom.setAttribute('y', '0');\n    dom.setAttribute('patternUnits', 'userSpaceOnUse');\n    this.updateDom(pattern, dom);\n    this.addDom(dom);\n    return dom;\n  };\n  PatternManager.prototype.update = function (pattern) {\n    if (!isPattern(pattern)) {\n      return;\n    }\n    var that = this;\n    this.doUpdate(pattern, function () {\n      var dom = patternDomMap.get(pattern);\n      that.updateDom(pattern, dom);\n    });\n  };\n  PatternManager.prototype.updateDom = function (pattern, patternDom) {\n    var svgElement = pattern.svgElement;\n    if (svgElement instanceof SVGElement) {\n      if (svgElement.parentNode !== patternDom) {\n        patternDom.innerHTML = '';\n        patternDom.appendChild(svgElement);\n        patternDom.setAttribute('width', pattern.svgWidth + '');\n        patternDom.setAttribute('height', pattern.svgHeight + '');\n      }\n    } else {\n      var img = void 0;\n      var prevImage = patternDom.getElementsByTagName('image');\n      if (prevImage.length) {\n        if (pattern.image) {\n          img = prevImage[0];\n        } else {\n          patternDom.removeChild(prevImage[0]);\n          return;\n        }\n      } else if (pattern.image) {\n        img = this.createElement('image');\n      }\n      if (img) {\n        var imageSrc = void 0;\n        var patternImage = pattern.image;\n        if (typeof patternImage === 'string') {\n          imageSrc = patternImage;\n        } else if (patternImage instanceof HTMLImageElement) {\n          imageSrc = patternImage.src;\n        } else if (patternImage instanceof HTMLCanvasElement) {\n          imageSrc = patternImage.toDataURL();\n        }\n        if (imageSrc) {\n          img.setAttribute('href', imageSrc);\n          img.setAttribute('x', '0');\n          img.setAttribute('y', '0');\n          var hostEl = {\n            dirty: function () {}\n          };\n          var createdImage = createOrUpdateImage(imageSrc, img, hostEl, function (img) {\n            patternDom.setAttribute('width', img.width + '');\n            patternDom.setAttribute('height', img.height + '');\n          });\n          if (createdImage && createdImage.width && createdImage.height) {\n            patternDom.setAttribute('width', createdImage.width + '');\n            patternDom.setAttribute('height', createdImage.height + '');\n          }\n          patternDom.appendChild(img);\n        }\n      }\n    }\n    var x = pattern.x || 0;\n    var y = pattern.y || 0;\n    var rotation = (pattern.rotation || 0) / Math.PI * 180;\n    var scaleX = pattern.scaleX || 1;\n    var scaleY = pattern.scaleY || 1;\n    var transform = \"translate(\" + x + \", \" + y + \") rotate(\" + rotation + \") scale(\" + scaleX + \", \" + scaleY + \")\";\n    patternDom.setAttribute('patternTransform', transform);\n    patternDomMap.set(pattern, patternDom);\n  };\n  PatternManager.prototype.markUsed = function (displayable) {\n    if (displayable.style) {\n      if (isPattern(displayable.style.fill)) {\n        _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.fill));\n      }\n      if (isPattern(displayable.style.stroke)) {\n        _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.stroke));\n      }\n    }\n  };\n  return PatternManager;\n}(Definable);\nexport default PatternManager;","map":{"version":3,"names":["__extends","Definable","zrUtil","createOrUpdateImage","WeakMap","isPattern","value","image","svgElement","patternDomMap","PatternManager","_super","zrId","svgRoot","call","prototype","addWithoutUpdate","displayable","style","that_1","each","fillOrStroke","pattern","defs","getDefs","dom","get","contains","addDom","add","markUsed","id","getAttribute","setAttribute","createElement","nextId","_zrId","updateDom","update","that","doUpdate","patternDom","SVGElement","parentNode","innerHTML","appendChild","svgWidth","svgHeight","img","prevImage","getElementsByTagName","length","removeChild","imageSrc","patternImage","HTMLImageElement","src","HTMLCanvasElement","toDataURL","hostEl","dirty","createdImage","width","height","x","y","rotation","Math","PI","scaleX","scaleY","transform","set","fill","markDomUsed","stroke"],"sources":["/Users/jiong/Downloads/my-app/node_modules/zrender/lib/svg/helper/PatternManager.js"],"sourcesContent":["import { __extends } from \"tslib\";\nimport Definable from './Definable';\nimport * as zrUtil from '../../core/util';\nimport { createOrUpdateImage } from '../../graphic/helper/image';\nimport WeakMap from '../../core/WeakMap';\nfunction isPattern(value) {\n    return value && (!!value.image || !!value.svgElement);\n}\nvar patternDomMap = new WeakMap();\nvar PatternManager = (function (_super) {\n    __extends(PatternManager, _super);\n    function PatternManager(zrId, svgRoot) {\n        return _super.call(this, zrId, svgRoot, ['pattern'], '__pattern_in_use__') || this;\n    }\n    PatternManager.prototype.addWithoutUpdate = function (svgElement, displayable) {\n        if (displayable && displayable.style) {\n            var that_1 = this;\n            zrUtil.each(['fill', 'stroke'], function (fillOrStroke) {\n                var pattern = displayable.style[fillOrStroke];\n                if (isPattern(pattern)) {\n                    var defs = that_1.getDefs(true);\n                    var dom = patternDomMap.get(pattern);\n                    if (dom) {\n                        if (!defs.contains(dom)) {\n                            that_1.addDom(dom);\n                        }\n                    }\n                    else {\n                        dom = that_1.add(pattern);\n                    }\n                    that_1.markUsed(displayable);\n                    var id = dom.getAttribute('id');\n                    svgElement.setAttribute(fillOrStroke, 'url(#' + id + ')');\n                }\n            });\n        }\n    };\n    PatternManager.prototype.add = function (pattern) {\n        if (!isPattern(pattern)) {\n            return;\n        }\n        var dom = this.createElement('pattern');\n        pattern.id = pattern.id == null ? this.nextId++ : pattern.id;\n        dom.setAttribute('id', 'zr' + this._zrId\n            + '-pattern-' + pattern.id);\n        dom.setAttribute('x', '0');\n        dom.setAttribute('y', '0');\n        dom.setAttribute('patternUnits', 'userSpaceOnUse');\n        this.updateDom(pattern, dom);\n        this.addDom(dom);\n        return dom;\n    };\n    PatternManager.prototype.update = function (pattern) {\n        if (!isPattern(pattern)) {\n            return;\n        }\n        var that = this;\n        this.doUpdate(pattern, function () {\n            var dom = patternDomMap.get(pattern);\n            that.updateDom(pattern, dom);\n        });\n    };\n    PatternManager.prototype.updateDom = function (pattern, patternDom) {\n        var svgElement = pattern.svgElement;\n        if (svgElement instanceof SVGElement) {\n            if (svgElement.parentNode !== patternDom) {\n                patternDom.innerHTML = '';\n                patternDom.appendChild(svgElement);\n                patternDom.setAttribute('width', pattern.svgWidth + '');\n                patternDom.setAttribute('height', pattern.svgHeight + '');\n            }\n        }\n        else {\n            var img = void 0;\n            var prevImage = patternDom.getElementsByTagName('image');\n            if (prevImage.length) {\n                if (pattern.image) {\n                    img = prevImage[0];\n                }\n                else {\n                    patternDom.removeChild(prevImage[0]);\n                    return;\n                }\n            }\n            else if (pattern.image) {\n                img = this.createElement('image');\n            }\n            if (img) {\n                var imageSrc = void 0;\n                var patternImage = pattern.image;\n                if (typeof patternImage === 'string') {\n                    imageSrc = patternImage;\n                }\n                else if (patternImage instanceof HTMLImageElement) {\n                    imageSrc = patternImage.src;\n                }\n                else if (patternImage instanceof HTMLCanvasElement) {\n                    imageSrc = patternImage.toDataURL();\n                }\n                if (imageSrc) {\n                    img.setAttribute('href', imageSrc);\n                    img.setAttribute('x', '0');\n                    img.setAttribute('y', '0');\n                    var hostEl = {\n                        dirty: function () { }\n                    };\n                    var createdImage = createOrUpdateImage(imageSrc, img, hostEl, function (img) {\n                        patternDom.setAttribute('width', img.width + '');\n                        patternDom.setAttribute('height', img.height + '');\n                    });\n                    if (createdImage && createdImage.width && createdImage.height) {\n                        patternDom.setAttribute('width', createdImage.width + '');\n                        patternDom.setAttribute('height', createdImage.height + '');\n                    }\n                    patternDom.appendChild(img);\n                }\n            }\n        }\n        var x = pattern.x || 0;\n        var y = pattern.y || 0;\n        var rotation = (pattern.rotation || 0) / Math.PI * 180;\n        var scaleX = pattern.scaleX || 1;\n        var scaleY = pattern.scaleY || 1;\n        var transform = \"translate(\" + x + \", \" + y + \") rotate(\" + rotation + \") scale(\" + scaleX + \", \" + scaleY + \")\";\n        patternDom.setAttribute('patternTransform', transform);\n        patternDomMap.set(pattern, patternDom);\n    };\n    PatternManager.prototype.markUsed = function (displayable) {\n        if (displayable.style) {\n            if (isPattern(displayable.style.fill)) {\n                _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.fill));\n            }\n            if (isPattern(displayable.style.stroke)) {\n                _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.stroke));\n            }\n        }\n    };\n    return PatternManager;\n}(Definable));\nexport default PatternManager;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}